<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hakimi Wallpaper - Quote v6.0</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        :root { 
            --primary: #1e3a8a; /* Navy Blue */
            --bg: #f3f4f6; 
            --white: #ffffff;
            --danger: #ef4444;
            --success: #10b981;
            --border: #e2e8f0;
        }
        
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); padding: 10px; margin: 0; color: #333; }
        .container { max-width: 1400px; margin: auto; background: var(--white); padding: 15px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }

        /* HEADER & CUSTOMER */
        .header { text-align: center; border-bottom: 4px solid var(--primary); padding-bottom: 15px; margin-bottom: 20px; }
        .header h1 { margin: 0; color: var(--primary); font-size: 22px; text-transform: uppercase; }
        .customer-section { background: #eff6ff; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 5px solid var(--primary); }
        .info-group { margin-bottom: 10px; }
        .info-group label { display: block; font-weight: 600; font-size: 12px; color: #555; margin-bottom: 4px; }
        .info-group input { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 16px; box-sizing: border-box; }

        /* TABLE & INPUTS */
        .table-wrapper { width: 100%; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 15px; font-size: 13px; min-width: 1000px; }
        th { background: var(--primary); color: white; padding: 12px 5px; font-size: 11px; text-transform: uppercase; }
        td { border-bottom: 1px solid var(--border); padding: 8px 4px; text-align: center; vertical-align: middle; }
        
        input, select { width: 90%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; text-align: center; font-size: 14px; }
        .auto-field { background: #e0f2fe !important; font-weight: bold; color: var(--primary); border: none !important; }
        
        /* Checkbox Style */
        .aster-wrapper { display: flex; align-items: center; justify-content: center; gap: 5px; font-size: 12px; }
        input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; }

        /* MOBILE CARD VIEW */
        @media screen and (max-width: 1000px) {
            table, tbody { display: block; width: 100%; min-width: 0 !important; }
            thead { display: none; }
            .item-row { display: block; background: white; border: 2px solid var(--border); margin-bottom: 15px; padding: 15px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); }
            .item-row td { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #f1f5f9; text-align: right; }
            .item-row td:last-child { border-bottom: none; }
            .item-row td::before { content: attr(data-label); font-weight: 700; color: #64748b; font-size: 12px; text-transform: uppercase; text-align: left; width: 45%; }
            .item-row input, .item-row select, .track-inputs { width: 50% !important; }
            .action-cell { flex-direction: row; justify-content: flex-end; gap: 10px; }
            .action-cell::before { display: none; }
        }

        /* BUTTONS */
        .controls { display: flex; flex-direction: column; gap: 10px; margin: 20px 0; }
        button { width: 100%; padding: 15px; font-weight: bold; border-radius: 8px; border: none; font-size: 16px; color: white; cursor: pointer; }
        .btn-add { background: var(--success); }
        .btn-pdf { background: var(--primary); }
        .btn-whatsapp { background: #25D366; }
        .btn-icon { width: 35px; height: 35px; border-radius: 5px; font-size: 18px; padding: 0; margin-left: 5px; }
        .btn-copy { background: #3b82f6; } .btn-del { background: var(--danger); }

        /* DETAILED SUMMARY LAYOUT */
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .summary-box { background: white; padding: 20px; border-radius: 8px; border: 1px solid var(--border); box-shadow: 0 2px 10px rgba(0,0,0,0.03); }
        .summary-box h3 { margin: 0 0 15px 0; color: var(--primary); border-bottom: 2px solid #fbbf24; padding-bottom: 5px; font-size: 16px; }
        
        .summary-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f1f5f9; font-size: 14px; color: #444; }
        .summary-row span:last-child { font-weight: 600; color: #000; }
        
        .total-highlight { font-size: 1.2em; color: var(--danger); font-weight: 800; border-top: 2px solid #ccc; margin-top: 10px; padding-top: 10px; }
        .balance-row { color: var(--success); font-weight: bold; font-size: 1.1em; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>HAKIMI WALLPAPER PUNE</h1>
        <p>Contact: +91 95032 19051</p>
    </div>

    <div class="customer-section">
        <div class="info-group"><label>Customer Name</label><input type="text" id="custName" placeholder="Enter Name"></div>
        <div class="info-group"><label>Phone Number</label><input type="tel" id="custPhone" placeholder="Enter Phone"></div>
        <div class="info-group"><label>Date</label><input type="date" id="currentDate"></div>
        <div class="info-group"><label>Site / Address</label><input type="text" id="custSite" placeholder="Enter Site"></div>
    </div>

    <div class="table-wrapper">
        <table id="mainTable">
            <thead>
                <tr>
                    <th style="width:6%">Act</th>
                    <th style="width:10%">Space</th>
                    <th style="width:10%">Stitch</th>
                    <th style="width:6%">H</th>
                    <th style="width:6%">W</th>
                    <th style="width:6%">P/Sqft</th>
                    <th style="width:12%">Fabric</th>
                    <th style="width:5%">Aster</th>
                    <th style="width:12%">Track Info</th>
                    <th style="width:6%">Mtr</th>
                    <th style="width:7%">Rate</th>
                    <th style="width:6%">Disc%</th>
                    <th style="width:8%">Total</th>
                </tr>
            </thead>
            <tbody id="items"></tbody>
        </table>
        <div id="emptyMsg" style="text-align:center; padding:20px; color:#999; display:none;">No items added.</div>
    </div>

    <div class="controls">
        <button class="btn-add" onclick="addRow()">+ Add New Item</button>
        <div style="display:flex; gap:10px;">
            <button class="btn-pdf" onclick="generatePDF()">üìÑ Download PDF</button>
            <button class="btn-whatsapp" onclick="openWA()">üí¨ WhatsApp</button>
        </div>
    </div>

    <div class="summary-grid">
        <div class="summary-box">
            <h3>Product Summary</h3>
            <div class="summary-row"><span>Total Fabric:</span> <span id="summ_fabric">0.00</span></div>
            <div class="summary-row"><span>Roman (<span id="summ_roman_sqft">0</span> Sqft):</span> <span id="summ_roman_cost">0.00</span></div>
            <div class="summary-row"><span>Roller/Zebra:</span> <span id="summ_roller">0.00</span></div>
            <div class="summary-row"><span>Tailoring (P x 150):</span> <span id="summ_tailor">0.00</span></div>
            <div class="summary-row"><span>Aster (Lining x 200):</span> <span id="summ_aster">0.00</span></div>
            <div class="summary-row total-highlight"><span>Product Total:</span> <span id="box1Total">0.00</span></div>
            
            <div class="summary-row" style="margin-top:15px; align-items:center; background:#f0f9ff; padding:10px;">
                <span>Advance Paid:</span> 
                <input type="number" id="advance" oninput="calculateAll()" value="0" style="width:80px; text-align:right;">
            </div>
            <div class="summary-row balance-row" style="padding:10px;">
                <span>Balance Due:</span> <span id="balance">0.00</span>
            </div>
        </div>

        <div class="summary-box">
            <h3>Services & Hardware</h3>
            <div class="summary-row"><span>Hardware Total:</span> <span id="summ_hardware">0.00</span></div>
            <div class="summary-row"><span>Installation (<span id="summ_items">0</span> Items):</span> <span id="summ_install">0.00</span></div>
            <div class="summary-row"><span>Local Transport:</span> <span>300.00</span></div>
            <div class="summary-row total-highlight"><span>Services Total:</span> <span id="box2Total">0.00</span></div>
            
            <div class="summary-row" style="margin-top:20px; border:none; font-size:1.4em; color:var(--primary);">
                <span>Grand Total:</span> <span id="grandTotal">0.00</span>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('currentDate').valueAsDate = new Date();

    function createRowHTML(data = {}) {
        return `
            <td data-label="Actions" class="action-cell">
                <button class="btn-icon btn-copy" onclick="cloneRow(this)">üìÑ</button>
                <button class="btn-icon btn-del" onclick="removeRow(this)">üóëÔ∏è</button>
            </td>
            <td data-label="Space">
                <select onchange="calculateAll()">
                    <option ${data.space=='Living room'?'selected':''}>Living room</option>
                    <option ${data.space=='Master bedroom'?'selected':''}>Master bedroom</option>
                    <option ${data.space=='Kids bedroom'?'selected':''}>Kids bedroom</option>
                    <option ${data.space=='Bedroom'?'selected':''}>Bedroom</option>
                    <option ${data.space=='Guest room'?'selected':''}>Guest room</option>
                    <option ${data.space=='Other'?'selected':''}>Other</option>
                </select>
            </td>
            <td data-label="Stitch">
                <select class="stitch-type" onchange="calculateAll()">
                    <option value="none" ${data.stitch=='none'?'selected':''}>Select</option>
                    <option value="american" ${data.stitch=='american'?'selected':''}>American</option>
                    <option value="roman" ${data.stitch=='roman'?'selected':''}>Roman</option>
                    <option value="french" ${data.stitch=='french'?'selected':''}>French</option>
                    <option value="ring" ${data.stitch=='ring'?'selected':''}>Ring</option>
                    <option value="roller" ${data.stitch=='roller'?'selected':''}>Roller/Zebra</option>
                </select>
            </td>
            <td data-label="Height"><input type="number" class="val-h" oninput="calculateAll()" value="${data.h||''}" placeholder="H"></td>
            <td data-label="Width"><input type="number" class="val-w" oninput="calculateAll()" value="${data.w||''}" placeholder="W"></td>
            <td data-label="P / Sqft"><input type="number" class="val-p auto-field" readonly value="${data.p||''}"></td>
            <td data-label="Fabric"><input type="text" class="val-fabric" value="${data.fabric||''}" placeholder="Name"></td>
            
            <td data-label="Aster (Lining)">
                <div class="aster-wrapper">
                    <input type="checkbox" class="aster-check" onchange="calculateAll()" ${data.aster?'checked':''}>
                    <span>Add</span>
                </div>
            </td>

            <td data-label="Track Info">
                <div style="display:flex; gap:5px;">
                    <input type="text" class="track-name" placeholder="Name" value="${data.trackName||''}">
                    <input type="number" class="track-rate" placeholder="Rate" value="${data.trackRate||''}" oninput="calculateAll()">
                </div>
            </td>
            
            <td data-label="Mtr"><input type="number" class="mtr auto-field" readonly value="${data.mtr||''}"></td>
            <td data-label="Rate"><input type="number" class="rate" oninput="calculateAll()" value="${data.rate||''}"></td>
            <td data-label="Disc %"><input type="number" class="disc" oninput="calculateAll()" value="${data.disc||''}" placeholder="%"></td>
            <td data-label="Total"><strong><span class="rowTotal">${data.total||'0.00'}</span></strong></td>
        `;
    }

    function addRow() {
        const tr = document.createElement('tr');
        tr.className = 'item-row';
        tr.innerHTML = createRowHTML();
        document.getElementById('items').appendChild(tr);
        document.getElementById('emptyMsg').style.display = 'none';
    }

    function removeRow(btn) {
        const row = btn.closest('tr');
        row.remove();
        calculateAll();
    }

    function cloneRow(btn) {
        const row = btn.closest('tr');
        const data = {
            space: row.querySelector('td:nth-child(2) select').value,
            stitch: row.querySelector('.stitch-type').value,
            h: row.querySelector('.val-h').value,
            w: row.querySelector('.val-w').value,
            fabric: "", 
            rate: "",
            trackName: row.querySelector('.track-name').value,
            trackRate: row.querySelector('.track-rate').value,
            disc: row.querySelector('.disc').value,
            aster: row.querySelector('.aster-check').checked
        };
        const newRow = document.createElement('tr');
        newRow.className = 'item-row';
        newRow.innerHTML = createRowHTML(data);
        row.parentNode.insertBefore(newRow, row.nextSibling);
        calculateAll();
    }

    function calculateAll() {
        let fabCost=0, romanCost=0, rollerCost=0, tailorCost=0, asterCost=0, hwCost=0;
        let romanSqft=0, itemCount=0;

        document.querySelectorAll('.item-row').forEach(row => {
            itemCount++;
            const stitch = row.querySelector('.stitch-type').value;
            const h = parseFloat(row.querySelector('.val-h').value) || 0;
            const w = parseFloat(row.querySelector('.val-w').value) || 0;
            const rate = parseFloat(row.querySelector('.rate').value) || 0;
            const disc = parseFloat(row.querySelector('.disc').value) || 0;
            const aster = row.querySelector('.aster-check').checked;
            const trackRate = parseFloat(row.querySelector('.track-rate').value) || 0;
            
            let p=0, mtr=0, rowTot=0, sqft=0;

            if (h>0 && w>0) {
                // UPDATE: Round Up Sqft
                sqft = Math.ceil((h*w)/144);

                // 1. CALCULATE MTR & PLEATS
                if (stitch === 'american') p = Math.ceil(w/24);
                else if (stitch === 'roman') p = Math.ceil(w/46);
                else if (stitch === 'french') p = Math.ceil(w/19);
                else if (stitch === 'ring') p = Math.ceil(w/30);
                
                if (stitch === 'roman') {
                    // UPDATE: Round Up Meter
                    mtr = Math.ceil(((h+15)/39)*p);
                    rowTot = (mtr*rate) * (1 - disc/100);
                    
                    romanSqft += sqft;
                    romanCost += (sqft * 160); 
                } 
                else if (stitch === 'roller') {
                    // UPDATE: Round Up Roller Sqft
                    p = Math.ceil(Math.max(11, ((h+6)*w)/144)); 
                    rowTot = (p*rate) * (1 - disc/100);
                    rollerCost += rowTot; 
                } 
                else if (stitch !== 'none') {
                    // UPDATE: Round Up Meter
                    mtr = Math.ceil(((h+15)/39)*p);
                    rowTot = (mtr*rate) * (1 - disc/100);
                    tailorCost += (p * 150); 
                }
            }

            // Update Row UI
            row.querySelector('.val-p').value = p.toFixed(2);
            row.querySelector('.mtr').value = mtr.toFixed(2);
            row.querySelector('.rowTotal').innerText = rowTot.toFixed(2);

            // 2. ACCUMULATE COSTS
            if (stitch !== 'roller') {
                fabCost += rowTot; 
            }
            if (aster && mtr > 0) {
                asterCost += (mtr * 200);
            }
            if (trackRate > 0) {
                let rft = Math.ceil(w/12);
                hwCost += (rft * trackRate);
            }
        });

        // 3. UPDATE SUMMARY
        document.getElementById('summ_fabric').innerText = fabCost.toFixed(2);
        document.getElementById('summ_roman_sqft').innerText = romanSqft.toFixed(0);
        document.getElementById('summ_roman_cost').innerText = romanCost.toFixed(2);
        document.getElementById('summ_roller').innerText = rollerCost.toFixed(2);
        document.getElementById('summ_tailor').innerText = tailorCost.toFixed(2);
        document.getElementById('summ_aster').innerText = asterCost.toFixed(2);
        
        let box1 = fabCost + romanCost + rollerCost + tailorCost + asterCost;
        document.getElementById('box1Total').innerText = box1.toFixed(2);

        // Services
        let installCost = itemCount * 250;
        let transport = 300;
        
        document.getElementById('summ_hardware').innerText = hwCost.toFixed(2);
        document.getElementById('summ_items').innerText = itemCount;
        document.getElementById('summ_install').innerText = installCost.toFixed(2);
        
        let box2 = hwCost + installCost + transport;
        document.getElementById('box2Total').innerText = box2.toFixed(2);

        // Grand Total
        let grand = box1 + box2;
        document.getElementById('grandTotal').innerText = grand.toFixed(2);
        
        let adv = parseFloat(document.getElementById('advance').value) || 0;
        document.getElementById('balance').innerText = (grand - adv).toFixed(2);
    }

    function openWA() {
        let phone = document.getElementById('custPhone').value;
        let grand = document.getElementById('grandTotal').innerText;
        let name = document.getElementById('custName').value;
        let link = `https://wa.me/91${phone}?text=Hello ${name}, Your Quotation Total is ‚Çπ${grand}`;
        window.open(link, '_blank');
    }

        function generatePDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('p', 'pt', 'a4'); // 'p' = Portrait (Vertical)
        
        // 1. BRAND HEADER
        doc.setFillColor(30, 58, 138); // Navy Blue Header
        doc.rect(0, 0, 595, 80, 'F');
        
        doc.setFontSize(22); doc.setTextColor(255, 255, 255);
        doc.text("HAKIMI WALLPAPER PUNE", 297, 40, { align: "center" });
        
        doc.setFontSize(10); doc.setTextColor(220, 220, 220);
        doc.text("Contact: +91 95032 19051 | Pune, Maharashtra", 297, 60, { align: "center" });

        // 2. CUSTOMER DETAILS
        const cName = document.getElementById('custName').value || "Guest";
        const cPhone = document.getElementById('custPhone').value || "";
        const cDate = document.getElementById('currentDate').value;
        const cSite = document.getElementById('custSite').value || "";

        doc.setTextColor(0, 0, 0); doc.setFontSize(10);
        doc.text(`Customer: ${cName}`, 40, 110);
        doc.text(`Phone: ${cPhone}`, 40, 125);
        
        doc.text(`Date: ${cDate}`, 400, 110);
        doc.text(`Site: ${cSite}`, 400, 125);

        // 3. TABLE DATA PREPARATION
        const body = [];
        document.querySelectorAll('.item-row').forEach(row => {
            let h = row.querySelector('.val-h').value;
            let w = row.querySelector('.val-w').value;
            let tName = row.querySelector('.track-name').value;
            let tRate = row.querySelector('.track-rate').value;
            
            // Smart Columns: Combine HxW and Track Info to save space
            let sizeStr = (h && w) ? `${h}" x ${w}"` : "-";
            let trackStr = (tRate > 0) ? `${tName} (@${tRate})` : "-";
            let fabric = row.querySelector('.val-fabric').value || "-";
            let space = row.querySelector('td:nth-child(2) select').value;
            
            body.push([
                space,
                sizeStr,
                fabric,
                row.querySelector('.stitch-type').value,
                trackStr,
                row.querySelector('.mtr').value,
                row.querySelector('.rate').value,
                row.querySelector('.rowTotal').innerText
            ]);
        });

        // 4. GENERATE TABLE
        doc.autoTable({
            startY: 140,
            head: [['Room', 'Size', 'Fabric', 'Stitch', 'Hardware', 'Mtr', 'Rate', 'Total']],
            body: body,
            theme: 'striped',
            headStyles: { fillColor: [30, 58, 138], textColor: 255 },
            styles: { fontSize: 8, cellPadding: 4, valign: 'middle', halign: 'center' },
            columnStyles: {
                0: { halign: 'left', cellWidth: 70 }, // Room
                2: { halign: 'left', cellWidth: 80 }  // Fabric
            }
        });

        // 5. SUMMARY SECTION (Bottom of Page)
        let finalY = doc.lastAutoTable.finalY + 20;
        
        // Prevent writing off the page
        if (finalY > 700) { doc.addPage(); finalY = 40; }

        // Draw Summary Box
        doc.setDrawColor(200); doc.setFillColor(248, 250, 252);
        doc.roundedRect(300, finalY, 250, 160, 3, 3, 'FD'); // Gray Box

        doc.setFontSize(11); doc.setFont(undefined, 'bold'); doc.setTextColor(30, 58, 138);
        doc.text("Quotation Summary", 315, finalY + 20);

        doc.setFontSize(9); doc.setFont(undefined, 'normal'); doc.setTextColor(50);
        let y = finalY + 40;
        
        // Helper to draw a row
        function drawRow(label, value, isBold = false) {
            doc.setFont(undefined, isBold ? 'bold' : 'normal');
            doc.text(label, 315, y);
            doc.text(value, 535, y, { align: 'right' });
            y += 15;
        }

        drawRow("Total Fabric Cost:", document.getElementById('summ_fabric').innerText);
        drawRow("Making Charges:", document.getElementById('summ_roman_cost').innerText);
        drawRow("Hardware & Track:", document.getElementById('summ_hardware').innerText);
        drawRow("Stitching/Tailoring:", document.getElementById('summ_tailor').innerText);
        drawRow("Installation & Transport:", document.getElementById('box2Total').innerText); // Simplified service total
        
        // LINE
        doc.setDrawColor(200); doc.line(315, y-5, 535, y-5);
        y += 5;

        // GRAND TOTAL
        doc.setFontSize(12); doc.setTextColor(0);
        drawRow("Grand Total:", "Rs. " + document.getElementById('grandTotal').innerText, true);
        
        doc.setFontSize(10); doc.setTextColor(220, 53, 69); // Red color for Balance
        drawRow("Balance Due:", "Rs. " + document.getElementById('balance').innerText, true);

        // 6. SAVE
        doc.save(`Hakimi_Quote_${cName || 'New'}.pdf`);
    }


    // Init
    addRow();
</script>
</body>
</html>
